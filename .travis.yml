language: go

go:
  - "1.14"

services:
  - docker

jobs:
  include:

    - stage: test
      script: make test

    - stage: build and push
      if: (tag IS present) AND (branch = master)
      on:
        condition: $TRAVIS_TAG =~ ^\d+\.\d+(\.\d+)?$
      script:
        - echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
        - make docker-push

