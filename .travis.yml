language: go

go:
  - "1.14"

services:
  - docker

env:
  - GOPRIVATE=github.com/nsnikhil

before_install:
  - git config --global url."git@github.com:".insteadOf "https://github.com/"

jobs:
  include:

    - stage: test
      script: make test

    - stage: build and push
      if: tag IS present AND tag =~ ^\d+\.\d+(\.\d+)?$
      script:
        - echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
        - make docker-push

